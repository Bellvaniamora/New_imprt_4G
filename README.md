# New_imprt_4G
import 4G
SET @SD = DATE_ADD(CURDATE(),INTERVAL -1 DAY);
-- ----------------------------
-- Table structure for 2G HUAWEI HCPT
-- ----------------------------
DROP TABLE IF EXISTS `2g_ioh_kpi_hcpt_hw`;
CREATE TABLE `2g_ioh_kpi_hcpt_hw` (
  `date` date NOT NULL,
  `hour` time NOT NULL,
  `gbsc` varchar(100) NOT NULL,
  `cellci` int(10) NOT NULL,
  `cellname` varchar(100) NOT NULL,
  `cellindex` int(10) NOT NULL,
  `Integrity` varchar(100) NOT NULL,
	`IOH_CDR_CS`  double DEFAULT NULL,
	`IOH_CDR_CS_DENOM`  double DEFAULT NULL,
	`IOH_CDR_CS_NOM`  double DEFAULT NULL,
	`IOH_CDR_PS`  double DEFAULT NULL,
	`IOH_CDR_PS_DENOM`  double DEFAULT NULL,
	`IOH_CDR_PS_NOM`  double DEFAULT NULL,
	`IOH_CELL_AVAILABILITY`  double DEFAULT NULL,
	`MC_H3I_Cell Availability_Denom`  double DEFAULT NULL,
	`MC_H3I_Cell Availability_Nom`  double DEFAULT NULL,
	`IOH_CSSR_CS`  double DEFAULT NULL,
	`IOH_CSSR_CS_IMAS`  double DEFAULT NULL,
	`IOH_CSSR_CS_IMAS_DENOM`  double DEFAULT NULL,
	`IOH_CSSR_CS_IMAS_NOM`  double DEFAULT NULL,
	`IOH_CSSR_CS_SDCCH`  double DEFAULT NULL,
	`IOH_CSSR_CS_SDCCH_DENOM`  double DEFAULT NULL,
	`IOH_CSSR_CS_SDCCH_NOM`  double DEFAULT NULL,
	`IOH_CSSR_CS_TCH`  double DEFAULT NULL,
	`IOH_CSSR_CS_TCH_DENOM`  double DEFAULT NULL,
	`IOH_CSSR_CS_TCH_NOM`  double DEFAULT NULL,
	`IOH_CSSR_PS`  double DEFAULT NULL,
	`IOH_CSSR_PS_DENOM`  double DEFAULT NULL,
	`IOH_CSSR_PS_NOM`  double DEFAULT NULL,
	`IOH_DL_THROUGHPUT`  double DEFAULT NULL,
	`IOH_DL_THROUGHPUT_DENOM`  double DEFAULT NULL,
	`IOH_DL_THROUGHPUT_NOM`  double DEFAULT NULL,
	`IOH_HANDOVER_SR`  double DEFAULT NULL,
	`IOH_HANDOVER_SR_DENOM`  double DEFAULT NULL,
	`IOH_HANDOVER_SR_NOM`  double DEFAULT NULL,
	`IOH_ICM_BAND`  double DEFAULT NULL,
	`IOH_ICM_BAND_DENOM`  double DEFAULT NULL,
	`IOH_ICM_BAND_NOM`  double DEFAULT NULL,
	`IOH_IRAT_HOSR`  double DEFAULT NULL,
	`IOH_IRAT_HOSR_DENOM`  double DEFAULT NULL,
	`IOH_IRAT_HOSR_NOM`  double DEFAULT NULL,
	`IOH_PDCH_AVAILABILITY`  double DEFAULT NULL,
	`IOH_PDCH_AVAILABILITY_DENOM`  double DEFAULT NULL,
	`IOH_PDCH_AVAILABILITY_NOM`  double DEFAULT NULL,
	`IOH_PDCH_CONGESTION`  double DEFAULT NULL,
	`IOH_PDCH_CONGESTION_DENOM`  double DEFAULT NULL,
	`IOH_PDCH_CONGESTION_NOM`  double DEFAULT NULL,
	`IOH_RXQUAL_DL`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_DENOM`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_DENOM1`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_DENOM2`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_NOM`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_NOM1`  double DEFAULT NULL,
	`IOH_RXQUAL_DL_NOM2`  double DEFAULT NULL,
	`IOH_RXQUAL_UL`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_DENOM`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_DENOM1`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_DENOM2`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_NOM`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_NOM1`  double DEFAULT NULL,
	`IOH_RXQUAL_UL_NOM2`  double DEFAULT NULL,
	`IOH_SDCCH_BLOCK_RATE`  double DEFAULT NULL,
	`IOH_SDCCH_BLOCK_RATE_DENOM`  double DEFAULT NULL,
	`IOH_SDCCH_BLOCK_RATE_NOM`  double DEFAULT NULL,
	`IOH_SDCCH_TRAFFIC`  double DEFAULT NULL,
	`IOH_TCH_AVAILABILITY`  double DEFAULT NULL,
	`IOH_TCH_AVAILABILITY_DENOM`  double DEFAULT NULL,
	`IOH_TCH_AVAILABILITY_NOM`  double DEFAULT NULL,
	`IOH_TCH_BLOCKING_RATE`  double DEFAULT NULL,
	`IOH_TCH_BLOCKING_RATE_DENOM`  double DEFAULT NULL,
	`IOH_TCH_BLOCKING_RATE_NOM`  double DEFAULT NULL,
	`IOH_TCH_TRAFFIC`  double DEFAULT NULL,
	`IOH_TRAFFIC_DATA_MBYTE`  double DEFAULT NULL,
	`IOH_UL_THROUGHPUT`  double DEFAULT NULL,
	`IOH_UL_THROUGHPUT_DENOM`  double DEFAULT NULL,
	`IOH_UL_THROUGHPUT_NOM`  double DEFAULT NULL,
  `siteid` varchar(12) DEFAULT NULL,
  `BSCid` int(10) DEFAULT NULL,
  `BCFid` int(10) DEFAULT NULL,
  `BTSid` int(10) DEFAULT NULL,
  `band` varchar(6) DEFAULT NULL,
  `mc_cluster` varchar(50) DEFAULT NULL,
  `nano_cluster` varchar(50) DEFAULT NULL,
  `sales_area` varchar(50) DEFAULT NULL,
  `city` varchar(50) DEFAULT NULL,
  `Branch` varchar(50) DEFAULT NULL,
  `long` double DEFAULT NULL,
  `lat` double DEFAULT NULL,
  `operator` varchar(10) DEFAULT NULL,
  `vendor` varchar(10) DEFAULT NULL,
	`siteid_after` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`date`,`hour`,`gbsc`,`cellci`,`cellname`,`cellindex`),
  UNIQUE KEY `1` (`date`,`hour`,`gbsc`,`cellci`,`cellname`,`cellindex`),
	KEY `2` (siteid),
	KEY `3` (`cellci`,`cellindex`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8;

-- ----------------------------
-- Table structure for 2G NOKIA HCPT
-- ----------------------------
DROP TABLE IF EXISTS `2g_ioh_kpi_hcpt`;
CREATE TABLE `2g_ioh_kpi_hcpt` (
  `PERIOD_START_TIME` varchar(20) CHARACTER SET latin1 NOT NULL,
  `BSC name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `BCF name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `BTS name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `DN` varchar(100) CHARACTER SET latin1 NOT NULL,
  `MC_H3I_Cell_Avail` double DEFAULT NULL,
  `MC_H3I_Cell_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_Cell_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_TCH_Availability` double DEFAULT NULL,
  `MC_H3I_TCH_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_TCH_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_IMM_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR CS_IMM_PART_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_TCH_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_TCH_PART_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_SD_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_SD_PART_DENOM` double DEFAULT NULL,
  `MC_ISAT_CSSR PS` double DEFAULT NULL,
  `MC_ISAT_CSSR_PS_NOM` double DEFAULT NULL,
  `MC_ISAT_CSSR_PS_DENOM` double DEFAULT NULL,
  `MC_ISAT_CDR_CS` double DEFAULT NULL,
  `MC_ISAT_CDR_CS_NOM` double DEFAULT NULL,
  `MC_ISAT_CDR_CS_DENOM` double DEFAULT NULL,
  `MC_H3I_CDR_PS` double DEFAULT NULL,
  `MC_H3I_CDR_PS_NOM` double DEFAULT NULL,
  `MC_H3I_CDR_PS_DENOM` double DEFAULT NULL,
  `MC_ISAT_HOSR` double DEFAULT NULL,
  `MC_ISAT_HOSR_NOM` double DEFAULT NULL,
  `MC_ISAT_HOSR_DENOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Traffic` double DEFAULT NULL,
  `MC_H3I_TCH_Traffic` double DEFAULT NULL,
  `MC_H3I_Traffic Data (MB)` double DEFAULT NULL,
  `MC_H3I_RxQual_DL` double DEFAULT NULL,
  `MC_H3I_RxQual_DL_NOM` double DEFAULT NULL,
  `MC_H3I_RxQual_DL_DENOM` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL_NOM` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL_DENOM` double DEFAULT NULL,
  `MC_H3I_ICM_Band` double DEFAULT NULL,
  `MC_H3I_ICM_Band_NOM` double DEFAULT NULL,
  `MC_H3I_ICM_Band_DENOM` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_DL THROUGHPUT` double DEFAULT NULL,
  `MC_H3I_UL THROUGHPUT` double DEFAULT NULL,
  `date` date DEFAULT NULL,
  `hour` time DEFAULT NULL,
  `siteid` varchar(12) DEFAULT NULL,
  `BSCid` int(10) DEFAULT NULL,
  `BCFid` int(10) DEFAULT NULL,
  `BTSid` int(10) DEFAULT NULL,
  `band` varchar(6) DEFAULT NULL,
  `mc_cluster` varchar(50) DEFAULT NULL,
  `nano_cluster` varchar(50) DEFAULT NULL,
  `sales_area` varchar(50) DEFAULT NULL,
  `city` varchar(50) DEFAULT NULL,
  `Branch` varchar(50) DEFAULT NULL,
  `long` double DEFAULT NULL,
  `lat` double DEFAULT NULL,
  `operator` varchar(10) DEFAULT NULL,
  `vendor` varchar(10) DEFAULT NULL,
	`siteid_after` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`PERIOD_START_TIME`,`BSC name`,`BCF name`,`BTS name`,`DN`),
	KEY `1` (`siteid`),
	KEY `2` (`BSCid`,`BCFid`,`BTSid`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;

-- ----------------------------
-- Table structure for 2G NOKIA INDOSAT
-- ----------------------------
DROP TABLE IF EXISTS `2g_ioh_kpi_isat`;
CREATE TABLE `2g_ioh_kpi_isat` (
  `PERIOD_START_TIME` varchar(20) CHARACTER SET latin1 NOT NULL,
  `BSC name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `BCF name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `BTS name` varchar(100) CHARACTER SET latin1 NOT NULL,
  `DN` varchar(100) CHARACTER SET latin1 NOT NULL,
  `MC_H3I_Cell_Avail` double DEFAULT NULL,
  `MC_H3I_Cell_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_Cell_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_TCH_Availability` double DEFAULT NULL,
  `MC_H3I_TCH_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_TCH_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability_NOM` double DEFAULT NULL,
  `MC_H3I_PDCH_Availability_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_IMM_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR CS_IMM_PART_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_TCH_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_TCH_PART_DENOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_SD_PART_NOM` double DEFAULT NULL,
  `MC_H3I_CSSR_CS_SD_PART_DENOM` double DEFAULT NULL,
  `MC_ISAT_CSSR PS` double DEFAULT NULL,
  `MC_ISAT_CSSR_PS_NOM` double DEFAULT NULL,
  `MC_ISAT_CSSR_PS_DENOM` double DEFAULT NULL,
  `MC_ISAT_CDR_CS` double DEFAULT NULL,
  `MC_ISAT_CDR_CS_NOM` double DEFAULT NULL,
  `MC_ISAT_CDR_CS_DENOM` double DEFAULT NULL,
  `MC_H3I_CDR_PS` double DEFAULT NULL,
  `MC_H3I_CDR_PS_NOM` double DEFAULT NULL,
  `MC_H3I_CDR_PS_DENOM` double DEFAULT NULL,
  `MC_ISAT_HOSR` double DEFAULT NULL,
  `MC_ISAT_HOSR_NOM` double DEFAULT NULL,
  `MC_ISAT_HOSR_DENOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Traffic` double DEFAULT NULL,
  `MC_H3I_TCH_Traffic` double DEFAULT NULL,
  `MC_H3I_Traffic Data (MB)` double DEFAULT NULL,
  `MC_H3I_RxQual_DL` double DEFAULT NULL,
  `MC_H3I_RxQual_DL_NOM` double DEFAULT NULL,
  `MC_H3I_RxQual_DL_DENOM` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL_NOM` double DEFAULT NULL,
  `MC_H3I_Rxqual_UL_DENOM` double DEFAULT NULL,
  `MC_H3I_ICM_Band` double DEFAULT NULL,
  `MC_H3I_ICM_Band_NOM` double DEFAULT NULL,
  `MC_H3I_ICM_Band_DENOM` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_TCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_SDCCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion_NOM` double DEFAULT NULL,
  `MC_H3I_PDCCH_Congestion_DENOM` double DEFAULT NULL,
  `MC_H3I_DL THROUGHPUT` double DEFAULT NULL,
  `MC_H3I_UL THROUGHPUT` double DEFAULT NULL,
  `date` date DEFAULT NULL,
  `hour` time DEFAULT NULL,
  `siteid` varchar(12) DEFAULT NULL,
  `BSCid` int(10) DEFAULT NULL,
  `BCFid` int(10) DEFAULT NULL,
  `BTSid` int(10) DEFAULT NULL,
  `band` varchar(6) DEFAULT NULL,
  `mc_cluster` varchar(50) DEFAULT NULL,
  `nano_cluster` varchar(50) DEFAULT NULL,
  `sales_area` varchar(50) DEFAULT NULL,
  `city` varchar(50) DEFAULT NULL,
  `Branch` varchar(50) DEFAULT NULL,
  `long` double DEFAULT NULL,
  `lat` double DEFAULT NULL,
  `operator` varchar(10) DEFAULT NULL,
  `vendor` varchar(10) DEFAULT NULL,
	`siteid_after` varchar(20) DEFAULT NULL,
  PRIMARY KEY (`PERIOD_START_TIME`,`BSC name`,`BCF name`,`BTS name`,`DN`),
	KEY `1` (`BSCid`,`BCFId`,`BTSId`)
) ENGINE=MyISAM DEFAULT CHARSET=utf8 ROW_FORMAT=DYNAMIC;


-- ----------------------------
-- LOAD DATA for RAW 2G HUAWEI HCPT
-- ----------------------------
LOAD DATA LOCAL INFILE 'F:/E/NPM/DB/Import MOCN/PRS_V4_2G_IOH_TEMPLATE_170_.csv' INTO TABLE 2g_ioh_kpi_hcpt_hw FIELDS TERMINATED BY ',' ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 7 LINES;

-- ----------------------------
-- LOAD DATA for RAW 2G NOKIA HCPT
-- ----------------------------
LOAD DATA LOCAL INFILE 'F:/E/NPM/DB/Import MOCN/2g_nok_hcpt_NS_.csv' INTO TABLE 2g_ioh_kpi_hcpt FIELDS TERMINATED BY ';' ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES;

-- ----------------------------
-- LOAD DATA for RAW 2G NOKIA INDOSAT
-- ----------------------------
LOAD DATA LOCAL INFILE 'F:/E/NPM/DB/Import MOCN/2g_nok_io_NS_.csv' INTO TABLE 2g_ioh_kpi_isat FIELDS TERMINATED BY ';' ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES;


-- ----------------------------
-- LOAD DATA for RAW 2G NOKIA INDOSAT SMT SS
-- ----------------------------
LOAD DATA LOCAL INFILE 'F:/E/NPM/DB/Import MOCN/2g_nok_SMTSS_NS_.csv' INTO TABLE 2g_ioh_kpi_isat FIELDS TERMINATED BY ';' ENCLOSED BY '"' LINES TERMINATED BY '\n' IGNORE 1 LINES;


-- ----------------------------
-- UPDATE DATA for RAW 2G HUAWEI HCPT
-- ----------------------------

UPDATE 2g_ioh_kpi_hcpt_hw a,2g_list_mocn_ns b 
SET
a.`Branch` = b.`Branch`,
a.`city` = b.`city`,
a.`sales_area` = b.`sales_area`,
a.`mc_cluster` = b.`mc_cluster`,
a.`nano_cluster` = b.`nano_cluster`,
a.`long` = b.`long`,
a.`lat` =  b.`lat`,
a.`vendor` = 'Huawei',
a.`siteid` = b.`siteid`,
a.`operator` = b.`operator`,
a.siteid_after = b.siteid_after,
a.band = b.band
where
a.`cellci` = b.`cellci` and a.`cellindex` = b.`cellindex`;

-- ----------------------------
-- UPDATE DATA for RAW 2G NOKIA HCPT
-- ----------------------------
UPDATE 2g_ioh_kpi_hcpt a
SET
a.`date` = STR_TO_DATE(REPLACE(PERIOD_START_TIME, '.', '/'), '%m/%d/%Y'),
a.`hour` = STR_TO_DATE(SUBSTRING_INDEX(PERIOD_START_TIME," ",-1),'%T'),
a.`vendor` = 'Nokia',
a.`BSCid` = SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BSC-',-1),'/', 1),
a.`BCFId` = REPLACE(SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BCF-',-1),'/', 1),"-",""),
a.`BTSId` = SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BTS-',-1),'/', 1);

UPDATE 2g_ioh_kpi_hcpt a,2g_list_mocn_ns b
SET
a.`Branch` = b.`Branch`,
a.city = b.city,
a.sales_area = b.sales_area,
a.mc_cluster = b.mc_cluster,
a.nano_cluster = b.nano_cluster,
a.`long` = b.`long`,
a.`lat` = b.`lat`,
a.siteid = b.siteid,
a.`siteid_after` = b.`siteid_after`,
a.band = b.band,
a.`operator` = b.`operator`
WHERE
a.`BSCid` = b.`BSCid` AND a.`BCFid` = b.`BCFid` AND a.`BTSid` = b.`BTSid`;

-- ----------------------------
-- UPDATE DATA for RAW 2G NOKIA INDOSAT
-- ----------------------------

UPDATE 2g_ioh_kpi_isat as a
SET
a.`date` = STR_TO_DATE(REPLACE(PERIOD_START_TIME, '.', '/'), '%m/%d/%Y'),
a.`hour` = STR_TO_DATE(SUBSTRING_INDEX(PERIOD_START_TIME," ",-1),'%T'),
a.`vendor` = 'Nokia',
a.`BSCid` = SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BSC-',-1),'/', 1),
a.`BCFId` = REPLACE(SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BCF-',-1),'/', 1),"-",""),
a.`BTSId` = SUBSTRING_INDEX(SUBSTRING_INDEX(DN,'BTS-',-1),'/', 1);

UPDATE 2g_ioh_kpi_isat a,2g_list_mocn_ns b
SET
a.`Branch` = b.`Branch`,
a.city = b.city,
a.sales_area = b.sales_area,
a.mc_cluster = b.mc_cluster,
a.nano_cluster = b.nano_cluster,
a.band = b.band,
a.`long` = b.`long`,
a.`lat` = b.`lat`,
a.`siteid` = b.siteid,
a.`siteid_after` = b.`siteid_after`,
a.`operator` = b.`operator`
WHERE
a.BSCid = b.BSCid and a.BCFId = b.BCFId and a.BTSId = b.BTSId;

-- ----------------------------
-- INSERT DATA for KPI 2G HOURLY HUAWEI HCPT 
-- ----------------------------
INSERT IGNORE INTO `2g_combine_hr_mocn` SELECT
`date`,
`hour`,
gbsc AS `BSC name`,
NULL AS `BCF name`,
cellname as `BTS name`,
`siteid`,
siteid_after,
NULL AS `BSCid`,
NULL AS `BCFid`,
NULL AS `BTSid`,
`cellci`,
`cellindex`,
`band`,
`mc_cluster`,
`nano_cluster`,
`sales_area`,
`city`,
`Branch`,
`long`,
`lat`,
`operator`,
`vendor`,

############NOKIA COUNTER ##############

0 AS `MC_H3I_Cell_Availability_NOM`,
0 AS `MC_H3I_Cell_Availability_DENOM`,
0 AS `MC_H3I_TCH_Availability_NOM`,
0 AS `MC_H3I_TCH_Availability_DENOM`,
0 AS `MC_H3I_PDCH_Availability_NOM`,
0 AS `MC_H3I_PDCH_Availability_DENOM`,
0 AS `MC_H3I_CSSR_CS_IMM_PART_NOM`,
0 AS `MC_H3I_CSSR CS_IMM_PART_DENOM`,
0 AS `MC_H3I_CSSR_CS_TCH_PART_NOM`,
0 AS `MC_H3I_CSSR_CS_TCH_PART_DENOM`,
0 AS `MC_H3I_CSSR_CS_SD_PART_NOM`,
0 AS `MC_H3I_CSSR_CS_SD_PART_DENOM`,
0 AS `MC_ISAT_CSSR_PS_NOM`,
0 AS `MC_ISAT_CSSR_PS_DENOM`,
0 AS `MC_ISAT_CDR_CS_NOM`,
0 AS `MC_ISAT_CDR_CS_DENOM`,
0 AS `MC_H3I_CDR_PS_NOM`,
0 AS `MC_H3I_CDR_PS_DENOM`,
0 AS `MC_ISAT_HOSR_NOM`,
0 AS `MC_ISAT_HOSR_DENOM`,
NULL AS `MC_H3I_SDCCH_Traffic`,
NULL AS `MC_H3I_TCH_Traffic`,
NULL AS `MC_H3I_Traffic Data (MB)`,
0 AS `MC_H3I_RxQual_DL_NOM`,
0 AS `MC_H3I_RxQual_DL_DENOM`,
0 AS `MC_H3I_Rxqual_UL_NOM`,
0 AS `MC_H3I_Rxqual_UL_DENOM`,
0 AS `MC_H3I_ICM_Band_NOM`,
0 AS `MC_H3I_ICM_Band_DENOM`,
0 AS `MC_H3I_TCH_Congestion_NOM`,
0 AS `MC_H3I_TCH_Congestion_DENOM`,
0 AS `MC_H3I_SDCCH_Congestion_NOM`,
0 AS `MC_H3I_SDCCH_Congestion_DENOM`,
0 AS `MC_H3I_PDCCH_Congestion_NOM`,
0 AS `MC_H3I_PDCCH_Congestion_DENOM`,
0 AS `MC_H3I_DL THROUGHPUT`,
0 AS `MC_H3I_UL THROUGHPUT`,

################ HUAWEI COUNTER ###############

`IOH_CDR_CS_DENOM`,
`IOH_CDR_CS_NOM`,
`IOH_CDR_PS_DENOM`,
`IOH_CDR_PS_NOM`,
`MC_H3I_Cell Availability_Denom`,
`MC_H3I_Cell Availability_Nom`,
`IOH_CSSR_CS_IMAS_DENOM`,
`IOH_CSSR_CS_IMAS_NOM`,
`IOH_CSSR_CS_SDCCH_DENOM`,
`IOH_CSSR_CS_SDCCH_NOM`,
`IOH_CSSR_CS_TCH_DENOM`,
`IOH_CSSR_CS_TCH_NOM`,
`IOH_CSSR_PS_DENOM`,
`IOH_CSSR_PS_NOM`,
`IOH_DL_THROUGHPUT_DENOM`,
`IOH_DL_THROUGHPUT_NOM`,
`IOH_HANDOVER_SR_DENOM`,
`IOH_HANDOVER_SR_NOM`,
`IOH_ICM_BAND_DENOM`,
`IOH_ICM_BAND_NOM`,
`IOH_IRAT_HOSR_DENOM`,
`IOH_IRAT_HOSR_NOM`,
`IOH_PDCH_AVAILABILITY_DENOM`,
`IOH_PDCH_AVAILABILITY_NOM`,
`IOH_PDCH_CONGESTION_DENOM`,
`IOH_PDCH_CONGESTION_NOM`,
`IOH_RXQUAL_DL_DENOM`,
`IOH_RXQUAL_DL_DENOM1`,
`IOH_RXQUAL_DL_DENOM2`,
`IOH_RXQUAL_DL_NOM`,
`IOH_RXQUAL_DL_NOM1`,
`IOH_RXQUAL_DL_NOM2`,
`IOH_RXQUAL_UL_DENOM`,
`IOH_RXQUAL_UL_DENOM1`,
`IOH_RXQUAL_UL_DENOM2`,
`IOH_RXQUAL_UL_NOM`,
`IOH_RXQUAL_UL_NOM1`,
`IOH_RXQUAL_UL_NOM2`,
`IOH_SDCCH_BLOCK_RATE_DENOM`,
`IOH_SDCCH_BLOCK_RATE_NOM`,
`IOH_SDCCH_TRAFFIC`,
`IOH_TCH_AVAILABILITY_DENOM`,
`IOH_TCH_AVAILABILITY_NOM`,
`IOH_TCH_BLOCKING_RATE_DENOM`,
`IOH_TCH_BLOCKING_RATE_NOM`,
`IOH_TCH_TRAFFIC`,
`IOH_TRAFFIC_DATA_MBYTE`,
`IOH_UL_THROUGHPUT_DENOM`,
`IOH_UL_THROUGHPUT_NOM`,

################ MAIN KPI ###############

100*(`MC_H3I_Cell Availability_Nom`)/(`MC_H3I_Cell Availability_Denom`) AS `avail`,
100*(`IOH_TCH_AVAILABILITY_NOM`)/(`IOH_TCH_AVAILABILITY_DENOM`) AS `tch_avail`,
100*(`IOH_PDCH_AVAILABILITY_NOM`)/(`IOH_PDCH_AVAILABILITY_DENOM`)AS `pdch_avail`,
100*((`IOH_CSSR_CS_IMAS_NOM`/`IOH_CSSR_CS_IMAS_DENOM`)*(`IOH_CSSR_CS_SDCCH_NOM`/`IOH_CSSR_CS_SDCCH_DENOM`)*(`IOH_CSSR_CS_TCH_NOM`/`IOH_CSSR_CS_TCH_DENOM`)) as cssr_cs,
100*(`IOH_CSSR_CS_IMAS_NOM`)/(`IOH_CSSR_CS_IMAS_DENOM`) AS `cssr_cs_imm`,
100*(`IOH_CSSR_CS_TCH_NOM`)/(`IOH_CSSR_CS_TCH_DENOM`) AS `cssr_cs_tch`,
100*(`IOH_CSSR_CS_SDCCH_NOM`)/(`IOH_CSSR_CS_SDCCH_DENOM`) AS `cssr_cs_sd`,
100*(`IOH_CSSR_PS_NOM`)/(`IOH_CSSR_PS_DENOM`) AS `cssr_ps`,
100*(`IOH_CDR_CS_NOM`)/(`IOH_CDR_CS_DENOM`) AS `cdr_cs`,
100*(`IOH_CDR_PS_NOM`)/(`IOH_CDR_PS_DENOM`) AS `cdr_ps`,
100*(`IOH_HANDOVER_SR_NOM`)/(`IOH_HANDOVER_SR_DENOM`) AS `hosr_sr`,
(`IOH_SDCCH_TRAFFIC`) AS `sddch_traffic`,
(`IOH_TCH_TRAFFIC`) AS `tch_traffic`,
(`IOH_TRAFFIC_DATA_MBYTE`) AS `traffic_data`,
100*(`IOH_RXQUAL_DL_NOM`)/(`IOH_RXQUAL_DL_DENOM`) AS `rxqual_dl`,
100*(`IOH_RXQUAL_UL_NOM`)/(`IOH_RXQUAL_UL_DENOM`) AS `rxqual_ul`,
(`IOH_ICM_BAND_NOM`)/(`IOH_ICM_BAND_DENOM`) AS `icm_band`,
100*(`IOH_TCH_BLOCKING_RATE_NOM`)/(`IOH_TCH_BLOCKING_RATE_DENOM`) AS `tch_cong`,
100*(`IOH_SDCCH_BLOCK_RATE_NOM`)/(`IOH_SDCCH_BLOCK_RATE_DENOM`) AS `sdcch_cong`,
100*(`IOH_PDCH_CONGESTION_NOM`)/(`IOH_PDCH_CONGESTION_DENOM`) AS `pdcch_cong`,
(`IOH_DL_THROUGHPUT_NOM`)/(`IOH_DL_THROUGHPUT_DENOM`) AS `dl_thp`,
(`IOH_UL_THROUGHPUT_NOM`)/(`IOH_UL_THROUGHPUT_DENOM`) AS `ul_thp`
FROM
2g_ioh_kpi_hcpt_hw;
DROP TABLE IF EXISTS `2g_ioh_kpi_hcpt_hw`;

-- ----------------------------
-- INSERT DATA for KPI 2G HOURLY NOKIA HCPT 
-- ----------------------------
INSERT IGNORE INTO `2g_combine_hr_mocn` SELECT
`date`,
`hour`,
`BSC name`,
`BCF name`,
`BTS name`,
`siteid`,
siteid_after,
`BSCid`,
`BCFid`,
`BTSid`,
NULL AS `cellci`,
NULL AS `cellindex`,
`band`,
`mc_cluster`,
`nano_cluster`,
`sales_area`,
`city`,
`Branch`,	
`long`,
`lat`,
`operator`,
`vendor`,

########### NOKIA COUNTER #################

`MC_H3I_Cell_Availability_NOM`,
`MC_H3I_Cell_Availability_DENOM`,
`MC_H3I_TCH_Availability_NOM`,
`MC_H3I_TCH_Availability_DENOM`,
`MC_H3I_PDCH_Availability_NOM`,
`MC_H3I_PDCH_Availability_DENOM`,
`MC_H3I_CSSR_CS_IMM_PART_NOM`,
`MC_H3I_CSSR CS_IMM_PART_DENOM`,
`MC_H3I_CSSR_CS_TCH_PART_NOM`,
`MC_H3I_CSSR_CS_TCH_PART_DENOM`,
`MC_H3I_CSSR_CS_SD_PART_NOM`,
`MC_H3I_CSSR_CS_SD_PART_DENOM`,
`MC_ISAT_CSSR_PS_NOM`,
`MC_ISAT_CSSR_PS_DENOM`,
`MC_ISAT_CDR_CS_NOM`,
`MC_ISAT_CDR_CS_DENOM`,
`MC_H3I_CDR_PS_NOM`,
`MC_H3I_CDR_PS_DENOM`,
`MC_ISAT_HOSR_NOM`,
`MC_ISAT_HOSR_DENOM`,
`MC_H3I_SDCCH_Traffic`,
`MC_H3I_TCH_Traffic`,
`MC_H3I_Traffic Data (MB)`,
`MC_H3I_RxQual_DL_NOM`,
`MC_H3I_RxQual_DL_DENOM`,
`MC_H3I_Rxqual_UL_NOM`,
`MC_H3I_Rxqual_UL_DENOM`,
`MC_H3I_ICM_Band_NOM`,
`MC_H3I_ICM_Band_DENOM`,
`MC_H3I_TCH_Congestion_NOM`,
`MC_H3I_TCH_Congestion_DENOM`,
`MC_H3I_SDCCH_Congestion_NOM`,
`MC_H3I_SDCCH_Congestion_DENOM`,
`MC_H3I_PDCCH_Congestion_NOM`,
`MC_H3I_PDCCH_Congestion_DENOM`,
`MC_H3I_DL THROUGHPUT`,
`MC_H3I_UL THROUGHPUT`,

################ HUAWEI COUNTER ##################

0 AS `IOH_CDR_CS_DENOM`,
0 AS `IOH_CDR_CS_NOM`,
0 AS `IOH_CDR_PS_DENOM`,
0 AS `IOH_CDR_PS_NOM`,
0 AS `MC_H3I_Cell Availability_Denom`,
0 AS `MC_H3I_Cell Availability_Nom`,
0 AS `IOH_CSSR_CS_IMAS_DENOM`,
0 AS `IOH_CSSR_CS_IMAS_NOM`,
0 AS `IOH_CSSR_CS_SDCCH_DENOM`,
0 AS `IOH_CSSR_CS_SDCCH_NOM`,
0 AS `IOH_CSSR_CS_TCH_DENOM`,
0 AS `IOH_CSSR_CS_TCH_NOM`,
0 AS `IOH_CSSR_PS_DENOM`,
0 AS `IOH_CSSR_PS_NOM`,
0 AS `IOH_DL_THROUGHPUT_DENOM`,
0 AS `IOH_DL_THROUGHPUT_NOM`,
0 AS `IOH_HANDOVER_SR_DENOM`,
0 AS `IOH_HANDOVER_SR_NOM`,
0 AS `IOH_ICM_BAND_DENOM`,
0 AS `IOH_ICM_BAND_NOM`,
0 AS `IOH_IRAT_HOSR_DENOM`,
0 AS `IOH_IRAT_HOSR_NOM`,
0 AS `IOH_PDCH_AVAILABILITY_DENOM`,
0 AS `IOH_PDCH_AVAILABILITY_NOM`,
0 AS `IOH_PDCH_CONGESTION_DENOM`,
0 AS `IOH_PDCH_CONGESTION_NOM`,
0 AS `IOH_RXQUAL_DL_DENOM`,
0 AS `IOH_RXQUAL_DL_DENOM1`,
0 AS `IOH_RXQUAL_DL_DENOM2`,
0 AS `IOH_RXQUAL_DL_NOM`,
0 AS `IOH_RXQUAL_DL_NOM1`,
0 AS `IOH_RXQUAL_DL_NOM2`,
0 AS `IOH_RXQUAL_UL_DENOM`,
0 AS `IOH_RXQUAL_UL_DENOM1`,
0 AS `IOH_RXQUAL_UL_DENOM2`,
0 AS `IOH_RXQUAL_UL_NOM`,
0 AS `IOH_RXQUAL_UL_NOM1`,
0 AS `IOH_RXQUAL_UL_NOM2`,
0 AS `IOH_SDCCH_BLOCK_RATE_DENOM`,
0 AS `IOH_SDCCH_BLOCK_RATE_NOM`,
NULL AS `IOH_SDCCH_TRAFFIC`,
0 AS `IOH_TCH_AVAILABILITY_DENOM`,
0 AS `IOH_TCH_AVAILABILITY_NOM`,
0 AS `IOH_TCH_BLOCKING_RATE_DENOM`,
0 AS `IOH_TCH_BLOCKING_RATE_NOM`,
NULL AS `IOH_TCH_TRAFFIC`,
NULL AS `IOH_TRAFFIC_DATA_MBYTE`,
0 AS `IOH_UL_THROUGHPUT_DENOM`,
0 AS `IOH_UL_THROUGHPUT_NOM`,

########## MAIN KPI #################

100*(`MC_H3I_Cell_Availability_NOM`)/(`MC_H3I_Cell_Availability_DENOM`) AS avail,
100*(`MC_H3I_TCH_Availability_NOM`)/(`MC_H3I_TCH_Availability_DENOM`) AS tch_avail,
100*(`MC_H3I_PDCH_Availability_NOM`)/(`MC_H3I_PDCH_Availability_DENOM`) AS pdch_avail,
100*((`MC_H3I_CSSR_CS_IMM_PART_NOM`)*(`MC_H3I_CSSR_CS_TCH_PART_NOM`)*(`MC_H3I_CSSR_CS_SD_PART_NOM`))/((`MC_H3I_CSSR CS_IMM_PART_DENOM`)*(`MC_H3I_CSSR_CS_TCH_PART_DENOM`)*(`MC_H3I_CSSR_CS_SD_PART_DENOM`)) as cssr_cs,
100*(`MC_H3I_CSSR_CS_IMM_PART_NOM`)/(`MC_H3I_CSSR CS_IMM_PART_DENOM`) AS cssr_cs_imm,
100*(`MC_H3I_CSSR_CS_TCH_PART_NOM`)/(`MC_H3I_CSSR_CS_TCH_PART_DENOM`) AS cssr_cs_tch,
100*(`MC_H3I_CSSR_CS_SD_PART_NOM`)/(`MC_H3I_CSSR_CS_SD_PART_DENOM`) AS cssr_cs_sd,
100*(`MC_ISAT_CSSR_PS_NOM`)/(`MC_ISAT_CSSR_PS_DENOM`) AS cssr_ps,
100*(`MC_ISAT_CDR_CS_NOM`)/(`MC_ISAT_CDR_CS_DENOM`) AS cdr_cs,
100*(`MC_H3I_CDR_PS_NOM`)/(`MC_H3I_CDR_PS_DENOM`) AS cdr_ps,
100*(`MC_ISAT_HOSR_NOM`)/(`MC_ISAT_HOSR_DENOM`) AS hosr_sr,
(`MC_H3I_SDCCH_Traffic`) AS sddch_traffic,
(`MC_H3I_TCH_Traffic`) AS tch_traffic,
(`MC_H3I_Traffic Data (MB)`) AS traffic_data,
100*(`MC_H3I_RxQual_DL_NOM`)/(`MC_H3I_RxQual_DL_DENOM`) AS rxqual_dl,
100*(`MC_H3I_Rxqual_UL_NOM`)/(`MC_H3I_Rxqual_UL_DENOM`) AS rxqual_ul,
(`MC_H3I_ICM_Band_NOM`)/(`MC_H3I_ICM_Band_DENOM`) AS icm_band,
100*(`MC_H3I_TCH_Congestion_NOM`)/(`MC_H3I_TCH_Congestion_DENOM`) AS tch_cong,
100*(`MC_H3I_SDCCH_Congestion_NOM`)/(`MC_H3I_SDCCH_Congestion_DENOM`) AS sdcch_cong,
100*(`MC_H3I_PDCCH_Congestion_NOM`)/(`MC_H3I_PDCCH_Congestion_DENOM`) AS pdcch_cong,
(`MC_H3I_DL THROUGHPUT`) AS dl_thp,
(`MC_H3I_UL THROUGHPUT`) AS ul_thp
FROM
2g_ioh_kpi_hcpt;
DROP TABLE IF EXISTS `2g_ioh_kpi_hcpt`;

-- ----------------------------
-- INSERT DATA for KPI 2G HOURLY NOKIA INDOSAT 
-- ----------------------------
INSERT IGNORE INTO `2g_combine_hr_mocn` SELECT
`date`,
`hour`,
`BSC name`,
`BCF name`,
`BTS name`,
`siteid`,
siteid_after,
`BSCid`,
`BCFid`,
`BTSid`,
NULL AS `cellci`,
NULL AS `cellindex`,
`band`,
`mc_cluster`,
`nano_cluster`,
`sales_area`,
`city`,
`Branch`,
`long`,
`lat`,
`operator`,
`vendor`,

########### NOKIA COUNTER #################

`MC_H3I_Cell_Availability_NOM`,
`MC_H3I_Cell_Availability_DENOM`,
`MC_H3I_TCH_Availability_NOM`,
`MC_H3I_TCH_Availability_DENOM`,
`MC_H3I_PDCH_Availability_NOM`,
`MC_H3I_PDCH_Availability_DENOM`,
`MC_H3I_CSSR_CS_IMM_PART_NOM`,
`MC_H3I_CSSR CS_IMM_PART_DENOM`,
`MC_H3I_CSSR_CS_TCH_PART_NOM`,
`MC_H3I_CSSR_CS_TCH_PART_DENOM`,
`MC_H3I_CSSR_CS_SD_PART_NOM`,
`MC_H3I_CSSR_CS_SD_PART_DENOM`,
`MC_ISAT_CSSR_PS_NOM`,
`MC_ISAT_CSSR_PS_DENOM`,
`MC_ISAT_CDR_CS_NOM`,
`MC_ISAT_CDR_CS_DENOM`,
`MC_H3I_CDR_PS_NOM`,
`MC_H3I_CDR_PS_DENOM`,
`MC_ISAT_HOSR_NOM`,
`MC_ISAT_HOSR_DENOM`,
`MC_H3I_SDCCH_Traffic`,
`MC_H3I_TCH_Traffic`,
`MC_H3I_Traffic Data (MB)`,
`MC_H3I_RxQual_DL_NOM`,
`MC_H3I_RxQual_DL_DENOM`,
`MC_H3I_Rxqual_UL_NOM`,
`MC_H3I_Rxqual_UL_DENOM`,
`MC_H3I_ICM_Band_NOM`,
`MC_H3I_ICM_Band_DENOM`,
`MC_H3I_TCH_Congestion_NOM`,
`MC_H3I_TCH_Congestion_DENOM`,
`MC_H3I_SDCCH_Congestion_NOM`,
`MC_H3I_SDCCH_Congestion_DENOM`,
`MC_H3I_PDCCH_Congestion_NOM`,
`MC_H3I_PDCCH_Congestion_DENOM`,
`MC_H3I_DL THROUGHPUT`,
`MC_H3I_UL THROUGHPUT`,

################ HUAWEI COUNTER ##################

0 AS `IOH_CDR_CS_DENOM`,
0 AS `IOH_CDR_CS_NOM`,
0 AS `IOH_CDR_PS_DENOM`,
0 AS `IOH_CDR_PS_NOM`,
0 AS `MC_H3I_Cell Availability_Denom`,
0 AS `MC_H3I_Cell Availability_Nom`,
0 AS `IOH_CSSR_CS_IMAS_DENOM`,
0 AS `IOH_CSSR_CS_IMAS_NOM`,
0 AS `IOH_CSSR_CS_SDCCH_DENOM`,
0 AS `IOH_CSSR_CS_SDCCH_NOM`,
0 AS `IOH_CSSR_CS_TCH_DENOM`,
0 AS `IOH_CSSR_CS_TCH_NOM`,
0 AS `IOH_CSSR_PS_DENOM`,
0 AS `IOH_CSSR_PS_NOM`,
0 AS `IOH_DL_THROUGHPUT_DENOM`,
0 AS `IOH_DL_THROUGHPUT_NOM`,
0 AS `IOH_HANDOVER_SR_DENOM`,
0 AS `IOH_HANDOVER_SR_NOM`,
0 AS `IOH_ICM_BAND_DENOM`,
0 AS `IOH_ICM_BAND_NOM`,
0 AS `IOH_IRAT_HOSR_DENOM`,
0 AS `IOH_IRAT_HOSR_NOM`,
0 AS `IOH_PDCH_AVAILABILITY_DENOM`,
0 AS `IOH_PDCH_AVAILABILITY_NOM`,
0 AS `IOH_PDCH_CONGESTION_DENOM`,
0 AS `IOH_PDCH_CONGESTION_NOM`,
0 AS `IOH_RXQUAL_DL_DENOM`,
0 AS `IOH_RXQUAL_DL_DENOM1`,
0 AS `IOH_RXQUAL_DL_DENOM2`,
0 AS `IOH_RXQUAL_DL_NOM`,
0 AS `IOH_RXQUAL_DL_NOM1`,
0 AS `IOH_RXQUAL_DL_NOM2`,
0 AS `IOH_RXQUAL_UL_DENOM`,
0 AS `IOH_RXQUAL_UL_DENOM1`,
0 AS `IOH_RXQUAL_UL_DENOM2`,
0 AS `IOH_RXQUAL_UL_NOM`,
0 AS `IOH_RXQUAL_UL_NOM1`,
0 AS `IOH_RXQUAL_UL_NOM2`,
0 AS `IOH_SDCCH_BLOCK_RATE_DENOM`,
0 AS `IOH_SDCCH_BLOCK_RATE_NOM`,
0 AS `IOH_SDCCH_TRAFFIC`,
0 AS `IOH_TCH_AVAILABILITY_DENOM`,
0 AS `IOH_TCH_AVAILABILITY_NOM`,
0 AS `IOH_TCH_BLOCKING_RATE_DENOM`,
0 AS `IOH_TCH_BLOCKING_RATE_NOM`,
0 AS `IOH_TCH_TRAFFIC`,
0 AS `IOH_TRAFFIC_DATA_MBYTE`,
0 AS `IOH_UL_THROUGHPUT_DENOM`,
0 AS `IOH_UL_THROUGHPUT_NOM`,

########## MAIN KPI #################

100*(`MC_H3I_Cell_Availability_NOM`)/(`MC_H3I_Cell_Availability_DENOM`) AS avail,
100*(`MC_H3I_TCH_Availability_NOM`)/(`MC_H3I_TCH_Availability_DENOM`) AS tch_avail,
100*(`MC_H3I_PDCH_Availability_NOM`)/(`MC_H3I_PDCH_Availability_DENOM`) AS pdch_avail,
100*((`MC_H3I_CSSR_CS_IMM_PART_NOM`)*(`MC_H3I_CSSR_CS_TCH_PART_NOM`)*(`MC_H3I_CSSR_CS_SD_PART_NOM`))/((`MC_H3I_CSSR CS_IMM_PART_DENOM`)*(`MC_H3I_CSSR_CS_TCH_PART_DENOM`)*(`MC_H3I_CSSR_CS_SD_PART_DENOM`)) as cssr_cs,
100*(`MC_H3I_CSSR_CS_IMM_PART_NOM`)/(`MC_H3I_CSSR CS_IMM_PART_DENOM`) AS cssr_cs_imm,
100*(`MC_H3I_CSSR_CS_TCH_PART_NOM`)/(`MC_H3I_CSSR_CS_TCH_PART_DENOM`) AS cssr_cs_tch,
100*(`MC_H3I_CSSR_CS_SD_PART_NOM`)/(`MC_H3I_CSSR_CS_SD_PART_DENOM`) AS cssr_cs_sd,
100*(`MC_ISAT_CSSR_PS_NOM`)/(`MC_ISAT_CSSR_PS_DENOM`) AS cssr_ps,
100*(`MC_ISAT_CDR_CS_NOM`)/(`MC_ISAT_CDR_CS_DENOM`) AS cdr_cs,
100*(`MC_H3I_CDR_PS_NOM`)/(`MC_H3I_CDR_PS_DENOM`) AS cdr_ps,
100*(`MC_ISAT_HOSR_NOM`)/(`MC_ISAT_HOSR_DENOM`) AS hosr_sr,
(`MC_H3I_SDCCH_Traffic`) AS sddch_traffic,
(`MC_H3I_TCH_Traffic`) AS tch_traffic,
(`MC_H3I_Traffic Data (MB)`) AS traffic_data,
100*(`MC_H3I_RxQual_DL_NOM`)/(`MC_H3I_RxQual_DL_DENOM`) AS rxqual_dl,
100*(`MC_H3I_Rxqual_UL_NOM`)/(`MC_H3I_Rxqual_UL_DENOM`) AS rxqual_ul,
(`MC_H3I_ICM_Band_NOM`)/(`MC_H3I_ICM_Band_DENOM`) AS icm_band,
100*(`MC_H3I_TCH_Congestion_NOM`)/(`MC_H3I_TCH_Congestion_DENOM`) AS tch_cong,
100*(`MC_H3I_SDCCH_Congestion_NOM`)/(`MC_H3I_SDCCH_Congestion_DENOM`) AS sdcch_cong,
100*(`MC_H3I_PDCCH_Congestion_NOM`)/(`MC_H3I_PDCCH_Congestion_DENOM`) AS pdcch_cong,
(`MC_H3I_DL THROUGHPUT`) AS dl_thp,
(`MC_H3I_UL THROUGHPUT`) AS ul_thp
FROM
2g_ioh_kpi_isat;

DROP TABLE IF EXISTS `2g_ioh_kpi_isat`;
OPTIMIZE TABLE `2g_combine_hr_mocn`;


-- ----------------------------
-- INSERT DATA for KPI 2G BUSY HOUR HUAWEI AND NOKIA IOH
-- ----------------------------
INSERT IGNORE INTO `2g_combine_hr_bh_mocn` SELECT * 
FROM 2g_combine_hr_mocn
WHERE date >= @SD
ORDER BY date,`BSC name`,`BCF name`,`BTS name`,`siteid`,`BSCid`,`BCFid`,`BTSid`,`vendor`,`operator`,
`MC_H3I_CSSR CS_IMM_PART_DENOM`+`MC_H3I_CSSR_CS_TCH_PART_DENOM`+`MC_H3I_CSSR_CS_SD_PART_DENOM`+`IOH_CSSR_CS_IMAS_DENOM`+`IOH_CSSR_CS_SDCCH_DENOM`+`IOH_CSSR_CS_TCH_DENOM` DESC;

OPTIMIZE TABLE `2g_combine_hr_bh_mocn`;


-- ----------------------------
-- INSERT DATA for KPI 2G DAILY HUAWEI AND NOKIA IOH
-- ----------------------------
INSERT IGNORE INTO 2g_combine_day_mocn SELECT
`date`,
`BSC name`,
`BCF name`,
`BTS name`,
`siteid`,
siteid_after,
`BSCid`,
`BCFid`,
`BTSid`,
`cellci`,
`cellindex`,
`band`,
`mc_cluster`,
`nano_cluster`,
`sales_area`,
`city`,
`Branch`,
`long`,
`lat`,
`operator`,
`vendor`,


##########NOKIA COUNTER ################

SUM(`MC_H3I_Cell_Availability_NOM`) AS `MC_H3I_Cell_Availability_NOM`,
SUM(`MC_H3I_Cell_Availability_DENOM`) AS `MC_H3I_Cell_Availability_DENOM`,
SUM(`MC_H3I_TCH_Availability_NOM`) AS `MC_H3I_TCH_Availability_NOM`,
SUM(`MC_H3I_TCH_Availability_DENOM`) AS `MC_H3I_TCH_Availability_DENOM`,
SUM(`MC_H3I_PDCH_Availability_NOM`) AS `MC_H3I_PDCH_Availability_NOM`,
SUM(`MC_H3I_PDCH_Availability_DENOM`) AS `MC_H3I_PDCH_Availability_DENOM`,
SUM(`MC_H3I_CSSR_CS_IMM_PART_NOM`) AS `MC_H3I_CSSR_CS_IMM_PART_NOM`,
SUM(`MC_H3I_CSSR CS_IMM_PART_DENOM`) AS `MC_H3I_CSSR CS_IMM_PART_DENOM`,
SUM(`MC_H3I_CSSR_CS_TCH_PART_NOM`) AS `MC_H3I_CSSR_CS_TCH_PART_NOM`,
SUM(`MC_H3I_CSSR_CS_TCH_PART_DENOM`) AS `MC_H3I_CSSR_CS_TCH_PART_DENOM`,
SUM(`MC_H3I_CSSR_CS_SD_PART_NOM`) AS `MC_H3I_CSSR_CS_SD_PART_NOM`,
SUM(`MC_H3I_CSSR_CS_SD_PART_DENOM`) AS `MC_H3I_CSSR_CS_SD_PART_DENOM`,
SUM(`MC_ISAT_CSSR_PS_NOM`) AS `MC_ISAT_CSSR_PS_NOM`,
SUM(`MC_ISAT_CSSR_PS_DENOM`) AS `MC_ISAT_CSSR_PS_DENOM`,
SUM(`MC_ISAT_CDR_CS_NOM`) AS `MC_ISAT_CDR_CS_NOM`,
SUM(`MC_ISAT_CDR_CS_DENOM`) AS `MC_ISAT_CDR_CS_DENOM`,
SUM(`MC_H3I_CDR_PS_NOM`) AS `MC_H3I_CDR_PS_NOM`,
SUM(`MC_H3I_CDR_PS_DENOM`) AS `MC_H3I_CDR_PS_DENOM`,
SUM(`MC_ISAT_HOSR_NOM`) AS `MC_ISAT_HOSR_NOM`,
SUM(`MC_ISAT_HOSR_DENOM`) AS `MC_ISAT_HOSR_DENOM`,
SUM(`MC_H3I_SDCCH_Traffic`) AS `MC_H3I_SDCCH_Traffic`,
SUM(`MC_H3I_TCH_Traffic`) AS `MC_H3I_TCH_Traffic`,
SUM(`MC_H3I_Traffic Data (MB)`) AS `MC_H3I_Traffic Data (MB)`,
SUM(`MC_H3I_RxQual_DL_NOM`) AS `MC_H3I_RxQual_DL_NOM`,
SUM(`MC_H3I_RxQual_DL_DENOM`) AS `MC_H3I_RxQual_DL_DENOM`,
SUM(`MC_H3I_Rxqual_UL_NOM`) AS `MC_H3I_Rxqual_UL_NOM`,
SUM(`MC_H3I_Rxqual_UL_DENOM`) AS `MC_H3I_Rxqual_UL_DENOM`,
SUM(`MC_H3I_ICM_Band_NOM`) AS `MC_H3I_ICM_Band_NOM`,
SUM(`MC_H3I_ICM_Band_DENOM`) AS `MC_H3I_ICM_Band_DENOM`,
SUM(`MC_H3I_TCH_Congestion_NOM`) AS `MC_H3I_TCH_Congestion_NOM`,
SUM(`MC_H3I_TCH_Congestion_DENOM`) AS `MC_H3I_TCH_Congestion_DENOM`,
SUM(`MC_H3I_SDCCH_Congestion_NOM`) AS `MC_H3I_SDCCH_Congestion_NOM`,
SUM(`MC_H3I_SDCCH_Congestion_DENOM`) AS `MC_H3I_SDCCH_Congestion_DENOM`,
SUM(`MC_H3I_PDCCH_Congestion_NOM`) AS `MC_H3I_PDCCH_Congestion_NOM`,
SUM(`MC_H3I_PDCCH_Congestion_DENOM`) AS `MC_H3I_PDCCH_Congestion_DENOM`,

######### HUAWEI COUNTER ################################

SUM(`IOH_CDR_CS_DENOM`) AS `IOH_CDR_CS_DENOM`,
SUM(`IOH_CDR_CS_NOM`) AS `IOH_CDR_CS_NOM`,
SUM(`IOH_CDR_PS_DENOM`) AS `IOH_CDR_PS_DENOM`,
SUM(`IOH_CDR_PS_NOM`) AS `IOH_CDR_PS_NOM`,
SUM(`MC_H3I_Cell Availability_Denom`) AS `MC_H3I_Cell Availability_Denom`,
SUM(`MC_H3I_Cell Availability_Nom`) AS `MC_H3I_Cell Availability_Nom`,
SUM(`IOH_CSSR_CS_IMAS_DENOM`) AS `IOH_CSSR_CS_IMAS_DENOM`,
SUM(`IOH_CSSR_CS_IMAS_NOM`) AS `IOH_CSSR_CS_IMAS_NOM`,
SUM(`IOH_CSSR_CS_SDCCH_DENOM`) AS `IOH_CSSR_CS_SDCCH_DENOM`,
SUM(`IOH_CSSR_CS_SDCCH_NOM`) AS `IOH_CSSR_CS_SDCCH_NOM`,
SUM(`IOH_CSSR_CS_TCH_DENOM`) AS `IOH_CSSR_CS_TCH_DENOM`,
SUM(`IOH_CSSR_CS_TCH_NOM`) AS `IOH_CSSR_CS_TCH_NOM`,
SUM(`IOH_CSSR_PS_DENOM`) AS `IOH_CSSR_PS_DENOM`,
SUM(`IOH_CSSR_PS_NOM`) AS `IOH_CSSR_PS_NOM`,
SUM(`IOH_DL_THROUGHPUT_DENOM`) AS `IOH_DL_THROUGHPUT_DENOM`,
SUM(`IOH_DL_THROUGHPUT_NOM`) AS `IOH_DL_THROUGHPUT_NOM`,
SUM(`IOH_HANDOVER_SR_DENOM`) AS `IOH_HANDOVER_SR_DENOM`,
SUM(`IOH_HANDOVER_SR_NOM`) AS `IOH_HANDOVER_SR_NOM`,
SUM(`IOH_ICM_BAND_DENOM`) AS `IOH_ICM_BAND_DENOM`,
SUM(`IOH_ICM_BAND_NOM`) AS `IOH_ICM_BAND_NOM`,
SUM(`IOH_IRAT_HOSR_DENOM`) AS `IOH_IRAT_HOSR_DENOM`,
SUM(`IOH_IRAT_HOSR_NOM`) AS `IOH_IRAT_HOSR_NOM`,
SUM(`IOH_PDCH_AVAILABILITY_DENOM`) AS `IOH_PDCH_AVAILABILITY_DENOM`,
SUM(`IOH_PDCH_AVAILABILITY_NOM`) AS `IOH_PDCH_AVAILABILITY_NOM`,
SUM(`IOH_PDCH_CONGESTION_DENOM`) AS `IOH_PDCH_CONGESTION_DENOM`,
SUM(`IOH_PDCH_CONGESTION_NOM`) AS `IOH_PDCH_CONGESTION_NOM`,
SUM(`IOH_RXQUAL_DL_DENOM`) AS `IOH_RXQUAL_DL_DENOM`,
SUM(`IOH_RXQUAL_DL_DENOM1`) AS `IOH_RXQUAL_DL_DENOM1`,
SUM(`IOH_RXQUAL_DL_DENOM2`) AS `IOH_RXQUAL_DL_DENOM2`,
SUM(`IOH_RXQUAL_DL_NOM`) AS `IOH_RXQUAL_DL_NOM`,
SUM(`IOH_RXQUAL_DL_NOM1`) AS `IOH_RXQUAL_DL_NOM1`,
SUM(`IOH_RXQUAL_DL_NOM2`) AS `IOH_RXQUAL_DL_NOM2`,
SUM(`IOH_RXQUAL_UL_DENOM`) AS `IOH_RXQUAL_UL_DENOM`,
SUM(`IOH_RXQUAL_UL_DENOM1`) AS `IOH_RXQUAL_UL_DENOM1`,
SUM(`IOH_RXQUAL_UL_DENOM2`) AS `IOH_RXQUAL_UL_DENOM2`,
SUM(`IOH_RXQUAL_UL_NOM`) AS `IOH_RXQUAL_UL_NOM`,
SUM(`IOH_RXQUAL_UL_NOM1`) AS `IOH_RXQUAL_UL_NOM1`,
SUM(`IOH_RXQUAL_UL_NOM2`) AS `IOH_RXQUAL_UL_NOM2`,
SUM(`IOH_SDCCH_BLOCK_RATE_DENOM`) AS `IOH_SDCCH_BLOCK_RATE_DENOM`,
SUM(`IOH_SDCCH_BLOCK_RATE_NOM`) AS `IOH_SDCCH_BLOCK_RATE_NOM`,
SUM(`IOH_SDCCH_TRAFFIC`) AS `IOH_SDCCH_TRAFFIC`,
SUM(`IOH_TCH_AVAILABILITY_DENOM`) AS `IOH_TCH_AVAILABILITY_DENOM`,
SUM(`IOH_TCH_AVAILABILITY_NOM`) AS `IOH_TCH_AVAILABILITY_NOM`,
SUM(`IOH_TCH_BLOCKING_RATE_DENOM`) AS `IOH_TCH_BLOCKING_RATE_DENOM`,
SUM(`IOH_TCH_BLOCKING_RATE_NOM`) AS `IOH_TCH_BLOCKING_RATE_NOM`,
SUM(`IOH_TCH_TRAFFIC`) AS `IOH_TCH_TRAFFIC`,
SUM(`IOH_TRAFFIC_DATA_MBYTE`) AS `IOH_TRAFFIC_DATA_MBYTE`,
SUM(`IOH_UL_THROUGHPUT_DENOM`) AS `IOH_UL_THROUGHPUT_DENOM`,
SUM(`IOH_UL_THROUGHPUT_NOM`) AS `IOH_UL_THROUGHPUT_NOM`,

########## MAIN KPI #################

COALESCE(100*SUM(`MC_H3I_Cell_Availability_NOM`)/SUM(`MC_H3I_Cell_Availability_DENOM`),100*SUM(`MC_H3I_Cell Availability_Nom`)/SUM(`MC_H3I_Cell Availability_Denom`)) AS avail,
COALESCE(100*SUM(`MC_H3I_TCH_Availability_NOM`)/SUM(`MC_H3I_TCH_Availability_DENOM`),100*SUM(`IOH_TCH_AVAILABILITY_NOM`)/SUM(`IOH_TCH_AVAILABILITY_DENOM`)) AS tch_avail,
COALESCE(100*SUM(`MC_H3I_PDCH_Availability_NOM`)/SUM(`MC_H3I_PDCH_Availability_DENOM`),100*SUM(`IOH_PDCH_AVAILABILITY_NOM`)/SUM(`IOH_PDCH_AVAILABILITY_DENOM`)) AS pdch_avail,
COALESCE(100*(SUM(`MC_H3I_CSSR_CS_IMM_PART_NOM`)*SUM(`MC_H3I_CSSR_CS_TCH_PART_NOM`)*SUM(`MC_H3I_CSSR_CS_SD_PART_NOM`))/(SUM(`MC_H3I_CSSR CS_IMM_PART_DENOM`)*SUM(`MC_H3I_CSSR_CS_TCH_PART_DENOM`)*SUM(`MC_H3I_CSSR_CS_SD_PART_DENOM`)),
				 100*(SUM(`IOH_CSSR_CS_IMAS_NOM`)*SUM(`IOH_CSSR_CS_SDCCH_NOM`)*SUM(`IOH_CSSR_CS_TCH_NOM`))/(SUM(`IOH_CSSR_CS_IMAS_DENOM`)*SUM(`IOH_CSSR_CS_SDCCH_DENOM`)*SUM(`IOH_CSSR_CS_TCH_DENOM`)))as cssr_cs,
COALESCE(100*SUM(`MC_H3I_CSSR_CS_IMM_PART_NOM`)/SUM(`MC_H3I_CSSR CS_IMM_PART_DENOM`),100*SUM(`IOH_CSSR_CS_IMAS_NOM`)/SUM(`IOH_CSSR_CS_IMAS_DENOM`)) AS cssr_cs_imm,
COALESCE(100*SUM(`MC_H3I_CSSR_CS_TCH_PART_NOM`)/SUM(`MC_H3I_CSSR_CS_TCH_PART_DENOM`),100*SUM(`IOH_CSSR_CS_TCH_NOM`)/SUM(`IOH_CSSR_CS_TCH_DENOM`)) AS cssr_cs_tch,
COALESCE(100*SUM(`MC_H3I_CSSR_CS_SD_PART_NOM`)/SUM(`MC_H3I_CSSR_CS_SD_PART_DENOM`),100*SUM(`IOH_CSSR_CS_SDCCH_NOM`)/SUM(`IOH_CSSR_CS_SDCCH_DENOM`)) AS cssr_cs_sd,
COALESCE(100*SUM(`MC_ISAT_CSSR_PS_NOM`)/SUM(`MC_ISAT_CSSR_PS_DENOM`),100*SUM(`IOH_CSSR_PS_NOM`)/SUM(`IOH_CSSR_PS_DENOM`)) AS cssr_ps,
COALESCE(100*SUM(`MC_ISAT_CDR_CS_NOM`)/SUM(`MC_ISAT_CDR_CS_DENOM`),100*SUM(`IOH_CDR_CS_NOM`)/SUM(`IOH_CDR_CS_DENOM`)) AS cdr_cs,
COALESCE(100*SUM(`MC_H3I_CDR_PS_NOM`)/SUM(`MC_H3I_CDR_PS_DENOM`),100*SUM(`IOH_CDR_PS_NOM`)/SUM(`IOH_CDR_PS_DENOM`)) AS cdr_ps,
COALESCE(100*SUM(`MC_ISAT_HOSR_NOM`)/SUM(`MC_ISAT_HOSR_DENOM`),100*SUM(`IOH_HANDOVER_SR_NOM`)/SUM(`IOH_HANDOVER_SR_DENOM`)) AS hosr_sr,
SUM(`sddch_traffic`) AS sddch_traffic,
SUM(`tch_traffic`) AS tch_traffic,
SUM(`traffic_data`) AS traffic_data,
COALESCE(100*SUM(`MC_H3I_RxQual_DL_NOM`)/SUM(`MC_H3I_RxQual_DL_DENOM`),100*SUM(`IOH_RXQUAL_DL_NOM`)/SUM(`IOH_RXQUAL_DL_DENOM`)) AS rxqual_dl,
COALESCE(100*SUM(`MC_H3I_Rxqual_UL_NOM`)/SUM(`MC_H3I_Rxqual_UL_DENOM`),100*SUM(`IOH_RXQUAL_UL_NOM`)/SUM(`IOH_RXQUAL_UL_DENOM`)) AS rxqual_ul,
COALESCE(SUM(`MC_H3I_ICM_Band_NOM`)/SUM(`MC_H3I_ICM_Band_DENOM`),SUM(`IOH_ICM_BAND_NOM`)/SUM(`IOH_ICM_BAND_DENOM`)) AS icm_band,
COALESCE(100*SUM(`MC_H3I_TCH_Congestion_NOM`)/SUM(`MC_H3I_TCH_Congestion_DENOM`),100*SUM(`IOH_TCH_BLOCKING_RATE_NOM`)/SUM(`IOH_TCH_BLOCKING_RATE_DENOM`)) AS tch_cong,
COALESCE(100*SUM(`MC_H3I_SDCCH_Congestion_NOM`)/SUM(`MC_H3I_SDCCH_Congestion_DENOM`),100*SUM(`IOH_SDCCH_BLOCK_RATE_NOM`)/SUM(`IOH_SDCCH_BLOCK_RATE_DENOM`)) AS sdcch_cong,
COALESCE(100*SUM(`MC_H3I_PDCCH_Congestion_NOM`)/SUM(`MC_H3I_PDCCH_Congestion_DENOM`),100*SUM(`IOH_PDCH_CONGESTION_NOM`)/SUM(`IOH_PDCH_CONGESTION_DENOM`)) AS pdcch_cong,
AVG(NULLIF(`dl_thp`,0)) AS dl_thp,
AVG(NULLIF(`ul_thp`,0)) AS ul_thp
FROM
2g_combine_hr_mocn
WHERE date >= @SD
GROUP BY
date,`BSC name`,`BCF name`,`BTS name`,`siteid`,`BSCid`,`BCFid`,`BTSid`,`vendor`,`operator`;

OPTIMIZE TABLE `2g_combine_day_mocn`;
